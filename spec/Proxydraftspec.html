<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url(https://themes.googleusercontent.com/fonts/css?kit=OPeqXG-QxW3ZD8BtmPikfA);.lst-kix_k8bax42qs607-6>li:before{content:"\0025cf   "}ul.lst-kix_tf06s3mclfi-8{list-style-type:none}.lst-kix_k8bax42qs607-5>li:before{content:"\0025a0   "}.lst-kix_k8bax42qs607-7>li:before{content:"\0025cb   "}.lst-kix_k8bax42qs607-4>li:before{content:"\0025cb   "}.lst-kix_k8bax42qs607-8>li:before{content:"\0025a0   "}ul.lst-kix_bj98xkklmwce-8{list-style-type:none}ul.lst-kix_bj98xkklmwce-6{list-style-type:none}ul.lst-kix_bj98xkklmwce-7{list-style-type:none}ul.lst-kix_bj98xkklmwce-4{list-style-type:none}ul.lst-kix_bj98xkklmwce-5{list-style-type:none}ul.lst-kix_bj98xkklmwce-2{list-style-type:none}ul.lst-kix_bj98xkklmwce-3{list-style-type:none}ul.lst-kix_tf06s3mclfi-2{list-style-type:none}ul.lst-kix_bx0y16yjliox-0{list-style-type:none}.lst-kix_irsybue0kzr8-6>li:before{content:"\0025cf   "}ul.lst-kix_bj98xkklmwce-0{list-style-type:none}ul.lst-kix_tf06s3mclfi-3{list-style-type:none}ul.lst-kix_bx0y16yjliox-1{list-style-type:none}ul.lst-kix_bj98xkklmwce-1{list-style-type:none}ul.lst-kix_tf06s3mclfi-0{list-style-type:none}.lst-kix_irsybue0kzr8-7>li:before{content:"\0025cb   "}ul.lst-kix_tf06s3mclfi-1{list-style-type:none}ul.lst-kix_tf06s3mclfi-6{list-style-type:none}ul.lst-kix_bx0y16yjliox-4{list-style-type:none}.lst-kix_irsybue0kzr8-8>li:before{content:"\0025a0   "}ul.lst-kix_tf06s3mclfi-7{list-style-type:none}ul.lst-kix_bx0y16yjliox-5{list-style-type:none}ul.lst-kix_tf06s3mclfi-4{list-style-type:none}ul.lst-kix_bx0y16yjliox-2{list-style-type:none}ul.lst-kix_tf06s3mclfi-5{list-style-type:none}ul.lst-kix_bx0y16yjliox-3{list-style-type:none}ul.lst-kix_bx0y16yjliox-8{list-style-type:none}.lst-kix_irsybue0kzr8-2>li:before{content:"\0025a0   "}ul.lst-kix_bx0y16yjliox-6{list-style-type:none}.lst-kix_irsybue0kzr8-1>li:before{content:"\0025cb   "}.lst-kix_irsybue0kzr8-3>li:before{content:"\0025cf   "}ul.lst-kix_bx0y16yjliox-7{list-style-type:none}.lst-kix_irsybue0kzr8-5>li:before{content:"\0025a0   "}.lst-kix_irsybue0kzr8-4>li:before{content:"\0025cb   "}ul.lst-kix_k8bax42qs607-1{list-style-type:none}ul.lst-kix_k8bax42qs607-0{list-style-type:none}ul.lst-kix_k8bax42qs607-3{list-style-type:none}ul.lst-kix_k8bax42qs607-2{list-style-type:none}ul.lst-kix_k8bax42qs607-5{list-style-type:none}ul.lst-kix_k8bax42qs607-4{list-style-type:none}ul.lst-kix_k8bax42qs607-7{list-style-type:none}ul.lst-kix_k8bax42qs607-6{list-style-type:none}ul.lst-kix_k8bax42qs607-8{list-style-type:none}.lst-kix_irsybue0kzr8-0>li:before{content:"\0025cf   "}.lst-kix_tf06s3mclfi-2>li:before{content:"\0025a0   "}.lst-kix_tf06s3mclfi-3>li:before{content:"\0025cf   "}.lst-kix_tf06s3mclfi-1>li:before{content:"\0025cb   "}.lst-kix_tf06s3mclfi-5>li:before{content:"\0025a0   "}.lst-kix_tf06s3mclfi-6>li:before{content:"\0025cf   "}.lst-kix_tf06s3mclfi-7>li:before{content:"\0025cb   "}.lst-kix_tf06s3mclfi-0>li:before{content:"\0025cf   "}.lst-kix_tf06s3mclfi-8>li:before{content:"\0025a0   "}.lst-kix_bj98xkklmwce-8>li:before{content:"\0025a0   "}.lst-kix_bj98xkklmwce-6>li:before{content:"\0025cf   "}.lst-kix_bj98xkklmwce-7>li:before{content:"\0025cb   "}.lst-kix_tf06s3mclfi-4>li:before{content:"\0025cb   "}.lst-kix_bj98xkklmwce-5>li:before{content:"\0025a0   "}.lst-kix_bx0y16yjliox-2>li:before{content:"\0025a0   "}.lst-kix_bj98xkklmwce-2>li:before{content:"\0025a0   "}.lst-kix_bj98xkklmwce-3>li:before{content:"\0025cf   "}.lst-kix_bj98xkklmwce-0>li:before{content:"\0025cf   "}.lst-kix_bj98xkklmwce-4>li:before{content:"\0025cb   "}.lst-kix_bx0y16yjliox-1>li:before{content:"\0025cb   "}.lst-kix_bx0y16yjliox-5>li:before{content:"\0025a0   "}.lst-kix_bx0y16yjliox-6>li:before{content:"\0025cf   "}.lst-kix_bx0y16yjliox-0>li:before{content:"\0025cf   "}.lst-kix_bx0y16yjliox-8>li:before{content:"\0025a0   "}.lst-kix_bj98xkklmwce-1>li:before{content:"\0025cb   "}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}.lst-kix_bx0y16yjliox-7>li:before{content:"\0025cb   "}.lst-kix_k8bax42qs607-0>li:before{content:"\0025cf   "}ul.lst-kix_irsybue0kzr8-7{list-style-type:none}ul.lst-kix_irsybue0kzr8-8{list-style-type:none}ul.lst-kix_irsybue0kzr8-5{list-style-type:none}.lst-kix_k8bax42qs607-2>li:before{content:"\0025a0   "}ul.lst-kix_irsybue0kzr8-6{list-style-type:none}ul.lst-kix_irsybue0kzr8-3{list-style-type:none}.lst-kix_k8bax42qs607-1>li:before{content:"\0025cb   "}.lst-kix_k8bax42qs607-3>li:before{content:"\0025cf   "}ul.lst-kix_irsybue0kzr8-4{list-style-type:none}.lst-kix_bx0y16yjliox-4>li:before{content:"\0025cb   "}ul.lst-kix_irsybue0kzr8-1{list-style-type:none}ul.lst-kix_irsybue0kzr8-2{list-style-type:none}.lst-kix_bx0y16yjliox-3>li:before{content:"\0025cf   "}ul.lst-kix_irsybue0kzr8-0{list-style-type:none}ol{margin:0;padding:0}table td,table th{padding:0}.c8{padding-top:20pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c1{padding-top:18pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c7{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Roboto";font-style:normal}.c3{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:20pt;font-family:"Arial";font-style:normal}.c6{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:"Arial";font-style:normal}.c15{padding-top:0pt;padding-bottom:3pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c9{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:20pt;font-family:"Roboto";font-style:normal}.c2{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c10{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:"Roboto";font-style:normal}.c0{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c17{color:#000000;text-decoration:none;vertical-align:baseline;font-size:26pt;font-style:normal}.c12{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline}.c11{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c5{padding:0;margin:0}.c16{font-weight:400;font-family:"Roboto"}.c14{color:inherit;text-decoration:inherit}.c13{margin-left:36pt;padding-left:0pt}.c4{margin-left:72pt;padding-left:0pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c11 doc-content"><p class="c15 title" id="h.hdp1ipacndk9"><span class="c16 c17">Language Model Proxy Server</span></p><p class="c0"><span class="c7">Language: Any</span></p><p class="c0"><span class="c7">Don&rsquo;t bill for things marked TODO without further discussion</span></p><p class="c0"><span class="c7">The items here don&#39;t need to strictly be done in order, but the versions roughly match the levels of usefulness to me</span></p><h1 class="c8" id="h.6d0s5en3kle4"><span class="c9">v0.0.1</span></h1><p class="c0"><span>A replacement for existing openai-cd2-proxy</span></p><h2 class="c1" id="h.exmaesa6rjt1"><span class="c10">Authentication</span></h2><p class="c0"><span class="c7">Each API key should have a unique alphanumeric name. Each API key should map to a set of roles. Each role should grant access to a list of models.</span></p><p class="c0"><span class="c16">Support importing API keys from </span><span class="c12 c16"><a class="c14" href="https://www.google.com/url?q=https://github.com/cosmicoptima/openai-cd2-proxy&amp;sa=D&amp;source=editors&amp;ust=1705529134117573&amp;usg=AOvVaw12Nwshr8GnURUpH5a3MLbg">openai-cd2-proxy</a></span></p><p class="c0"><span class="c16">Removing/disabling keys should work</span></p><h2 class="c1" id="h.9cs3xg3zvfzm"><span class="c10">Model support</span></h2><p class="c0"><span class="c7">Support the OpenAI API, including the &ldquo;n&rdquo; parameter.</span></p><p class="c0"><span class="c7">It should be possible to customize &ldquo;api_base&rdquo;, &ldquo;organization&rdquo;, and &ldquo;api_key&rdquo; for each model</span></p><p class="c0"><span class="c7">Glomarize about model availability (i.e. don&rsquo;t leak info about whether a model is available or not)</span></p><p class="c0"><span class="c7">Streaming not required</span></p><h2 class="c1" id="h.pwt0l0ishq17"><span class="c6">Rate-limits</span></h2><p class="c0"><span class="c2">Global per-model tokens per minute and request per minute enforcement</span></p><p class="c0"><span>Requests should be held in queue until rate limit is met</span></p><h2 class="c1" id="h.a8g5nakvel16"><span class="c10">Metrics and monitoring</span></h2><p class="c0"><span class="c2">Log the time of requests, the user agent of requests, and the raw value of the &ldquo;n&rdquo; parameter</span></p><p class="c0"><span class="c2">&ldquo;prompt&rdquo; may be a string, an array of strings, an array of integers, an array of an array of token IDs, an array of objects, an array of an array of objects, etc.</span></p><p class="c0"><span class="c2">Import metrics from openai-cd2-proxy</span></p><h2 class="c1" id="h.wbokjo10pmn9"><span class="c6">Concurrency</span></h2><p class="c0"><span class="c2">It should be concurrent and thread safe</span></p><h2 class="c1" id="h.kolxb06mm2q3"><span class="c6">Deployment</span></h2><p class="c0"><span>Statically linked executables for Linux-x86 and Mac ARM or a Python program</span></p><h1 class="c8" id="h.12uahnb8tbqe"><span class="c9">v0.0.2</span></h1><h2 class="c1" id="h.cngbwix1c0ig"><span class="c10">Reloading configuration on demand</span></h2><h2 class="c1" id="h.f87zjmqycbb0"><span class="c6">Support Chapter 2</span></h2><p class="c0"><span class="c2">TODO: My em framework, has an OpenAI compatible API (both Completions and ChatCompletions), but I want to implement IPC somehow. (Unix sockets?)</span></p><h2 class="c1" id="h.orkq5hrkocrs"><span class="c6">Rate-limits</span></h2><p class="c0"><span class="c2">Per-key and per-role rate limits</span></p><h2 class="c1" id="h.4e2nmiu9zyf1"><span class="c6">Performance</span></h2><p class="c0"><span class="c2">HTTP Pipelining (via HTTP/1.1 or HTTP/2) </span></p><p class="c0"><span class="c2">Connection pooling (for concurrent requests)</span></p><h2 class="c1" id="h.304dwnvrvzp7"><span class="c6">Error handling</span></h2><p class="c0"><span>Pass errors back to the user</span></p><h1 class="c8" id="h.ugtiajpw4eh8"><span>v</span><span class="c3">0.0.3</span></h1><h2 class="c1" id="h.dk1lwluqwyb0"><span class="c6">Deployment</span></h2><p class="c0"><span class="c2">Windows-x86 support</span></p><h2 class="c1" id="h.1j3byj2vok0h"><span class="c6">Support open-source models</span></h2><p class="c0"><span class="c2">TODO</span></p><p class="c0"><span class="c2">System_fingerprint</span></p><p class="c0"><span class="c2">Ollama ?</span></p><p class="c0"><span class="c12"><a class="c14" href="https://www.google.com/url?q=https://github.com/theroyallab/tabbyAPI/&amp;sa=D&amp;source=editors&amp;ust=1705529134122068&amp;usg=AOvVaw0QqouV0v4mWV23FQD5Eri0">https://github.com/theroyallab/tabbyAPI/</a></span><span class="c2">&nbsp;?</span></p><h2 class="c1" id="h.hyc5sqy8yr1x"><span class="c6">Metrics and monitoring</span></h2><p class="c0"><span class="c2">Different types of keys</span></p><ul class="c5 lst-kix_bj98xkklmwce-0 start"><li class="c0 c13 li-bullet-0"><span class="c2">User keys</span></li></ul><ul class="c5 lst-kix_bj98xkklmwce-1 start"><li class="c0 c4 li-bullet-0"><span class="c2">Always map to a specific user</span></li></ul><ul class="c5 lst-kix_bj98xkklmwce-0"><li class="c0 c13 li-bullet-0"><span class="c2">Software keys</span></li></ul><ul class="c5 lst-kix_bj98xkklmwce-1 start"><li class="c0 c4 li-bullet-0"><span class="c2">Map dynamically to specific projects, project is passed as a header</span></li><li class="c0 c4 li-bullet-0"><span class="c2">End user is determined by the user parameter</span></li></ul><ul class="c5 lst-kix_bj98xkklmwce-0"><li class="c0 c13 li-bullet-0"><span class="c2">Ideally, support arbitrary tags</span></li></ul><ul class="c5 lst-kix_k8bax42qs607-0 start"><li class="c0 c13 li-bullet-0"><span class="c2">Real-time monitoring</span></li></ul><ul class="c5 lst-kix_k8bax42qs607-1 start"><li class="c0 c4 li-bullet-0"><span class="c2">Prometheus?</span></li></ul><p class="c0"><span class="c2">Logging</span></p><ul class="c5 lst-kix_bx0y16yjliox-0 start"><li class="c0 c13 li-bullet-0"><span class="c2">Some request contents will be logged, some won&rsquo;t be</span></li><li class="c0 c13 li-bullet-0"><span class="c2">Count the number of tokens in a separate thread and log the request usage</span></li></ul><ul class="c5 lst-kix_bx0y16yjliox-1 start"><li class="c0 c4 li-bullet-0"><span class="c2">Ways to visualize aggregate usage</span></li><li class="c0 c4 li-bullet-0"><span class="c2">Count input and output tokens for each request separately, but also log combined total</span></li></ul><p class="c0"><span class="c2">It should be possible to seamlessly aggregate / sync metrics across multiple trusted instances of the proxy, including unifying usernames</span></p><h2 class="c1" id="h.bm8j9prlhp1c"><span class="c6">Performance</span></h2><p class="c0"><span class="c2">TCP_NODELAY</span></p><p class="c0"><span class="c2">Keys with priorities; prioritize requests based on a niceness-like metric</span></p><h1 class="c8" id="h.g6kxkdmwf1nl"><span class="c3">v0.0.4</span></h1><h2 class="c1" id="h.t54nww66gky8"><span class="c6">Features</span></h2><p class="c0"><span class="c2">all_tokens parameter (feel free to change the name) that takes in an input string, and runs it through tiktoken again, with all tokens supported by the model </span></p><ul class="c5 lst-kix_tf06s3mclfi-0 start"><li class="c0 c13 li-bullet-0"><span class="c2">The list of supported tokens is configurable on the backend</span></li><li class="c0 c13 li-bullet-0"><span class="c2">This is so that multiple &lt;|endoftext|&gt; tokens can be supported, as well as weird tokens like &lt;|startoftext|&gt;</span></li></ul><h1 class="c8" id="h.3h0vs5gtcb3k"><span class="c3">v0.05</span></h1><h2 class="c1" id="h.8l0sv1ab55kg"><span class="c6">Metrics and monitoring</span></h2><p class="c0"><span class="c2">Alerting for when usage spikes in an anomalous way</span></p></body></html>